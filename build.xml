<project name="jmatrix" default="compile" basedir=".">
  <property name="src" location="src"/>
  <property name="bin" location="bin"/>
  <property name="doc" location="doc"/>
  <property name="test" location="test"/>

  <!-- properties -->

  <property name="junit"
            location="/usr/share/junit-4/lib/junit.jar"/>
  <property name="hamcrest"
            location="/usr/share/hamcrest-core-1.3/lib/hamcrest-core.jar"/>

  <presetdef name="javac">
    <javac includeantruntime="false" />
  </presetdef>

  <tstamp>
    <format property='build.time' pattern='yyyy-MM-dd HH:mm:ss'/>
  </tstamp>
  <echo>
    Build File : ${ant.file} 
    Run Date   : ${build.time}
    Run by     : ${user.name}
    Source Dir : ${src}
    Base Dir   : ${basedir}
    Java Home  : ${java.home}
  </echo>

  <!-- compilation targets -->

  <target name="compile" description="Compile the jmatrix package.">
    <javac srcdir="${src}/jmatrix" destdir="${bin}"/>
  </target>

  <target name="jar" description="Make a jar file." depends="compile">
    <jar destfile="jmatrix.jar" basedir="${bin}">
      <exclude name=".keep"/>
      <exclude name="**/test/**"/>
      <manifest>
        <attribute name="Version" value="1.0-dev"/>
      </manifest>
    </jar>
  </target>

  <!-- test targets -->

  <target name="test-compile"
          description="Compile the test cases."
          depends="compile">
    <mkdir dir="${bin}/test"/>
    <javac srcdir="${test}/jmatrix" destdir="${bin}/test">
      <classpath>
        <pathelement path="${classpath}"/>
        <pathelement location="${bin}"/>
        <pathelement location="${junit}"/>
      </classpath>
    </javac>
  </target>

  <target name="test-matrix"
          description="Run matrix tests."
          depends="test-compile">
    <java classname="org.junit.runner.JUnitCore" fork="true">
      <arg value="jmatrix.MatrixTests"/>
      <classpath>
        <pathelement path="${classpath}"/>
        <pathelement location="${bin}"/>
        <pathelement location="${bin}/test"/>
        <pathelement location="${junit}"/>
        <pathelement location="${hamcrest}"/>
      </classpath>
    </java>
  </target>

  <target name="test-permutation"
          description="Run permutation tests."
          depends="test-compile">
    <java classname="org.junit.runner.JUnitCore" fork="true">
      <arg value="jmatrix.PermutationTests"/>
      <classpath>
        <pathelement path="${classpath}"/>
        <pathelement location="${bin}"/>
        <pathelement location="${bin}/test"/>
        <pathelement location="${junit}"/>
        <pathelement location="${hamcrest}"/>
      </classpath>
    </java>
  </target>

  <target name="test-all"
          description="Run all tests."
          depends="test-matrix,test-permutation">
  </target>

  <!-- other targets -->

  <target name="doc" description="Generate API documentation.">
    <javadoc sourcepath="${src}" destdir="${doc}"/>
  </target>

  <target name="clean" description="Delete class files.">
    <delete dir="${bin}/jmatrix"/>
    <delete dir="${bin}/test"/>
    <delete includeemptydirs="true">
      <fileset dir="${doc}" includes="*.html"/>
      <fileset dir="${doc}" includes="*.css"/>
      <fileset dir="${doc}" includes="package-list"/>
      <fileset dir="${doc}/jmatrix" erroronmissingdir="false"/>
      <fileset dir="${doc}/resources" erroronmissingdir="false"/>
    </delete>
  </target>
</project>
